"use strict";var checkoutData,oliverTaxResponse,oliverProductTaxes;!function(p){var f=".acf-field-5d25148656536",g=".acf-field-5d25156b56537",v=".acf-field-5d251671a38b3",i=".acf-field-5d4a0a0c75c12";function o(){k(),p(".savedTag").remove(),p(".acf-input").show(),p(f+" select, "+g+" select, "+v+" select, "+i+" select").show().val("").trigger("change"),x()}function n(){location.reload()}function m(e){var t=p(" .tag-ordertype");p(f+" select").hide(),t&&t.remove(),p(f).append("<p class='savedTag tag-ordertype'>"+e+"</p>")}function h(e){var t=p(" .tag-sales");p(g+" .acf-input").hide(),t&&t.remove(),p(g).append("<p class='savedTag tag-sales'>"+e[0].text+"</p>")}function y(e){var t=p(" .tag-affiliate");p(v+" .acf-input").hide(),t&&t.remove(),0<e.length?p(v).append("<p class='savedTag tag-affiliate'>"+e[0].text+"</p>"):p(v).append("<p class='savedTag tag-affiliate'>N/A</p>")}function k(){var e={ordertypeVal:"",ordertype:"",salesRep:{},affiliate:{}};Cookies.set("truecustomtags",{ordertypeVal:e.ordertypeVal,ordertype:e.ordertype,salesRep:e.salesRep,affiliate:e.affiliate})}function x(){var e=Cookies.getJSON("truecustomtags");console.log(e)}function r(){var e=checkoutData;if("registerExtension"==e.oliverpos.event){console.log(e.data.checkoutData);var t={action:"get_tax_info",checkoutData:e.data.checkoutData};p.ajax({url:truefunction.ajax_url,type:"get",data:t,contentType:"application/json; charset=utf-8",dataType:"json",beforeSend:function(){console.log("REQUESTING TAX"),p(".current-taxes p").hide(),p("#loader").clone().appendTo(".current-taxes").show(),p("#customtags_button").addClass("disabled")},success:function(e){var t,s,a;console.log(e),t=oliverTaxResponse=e,p("#customtags_button").removeClass("disabled"),p(".current-taxes p").show(),p("#customFeeKey").text(t.jurisdictions.state+" Tax"),p("#customFeeAmount").text(t.amount_to_collect),s=new Array,a=oliverTaxResponse.breakdown.line_items,p.each(a,function(e,a){var o={},t=checkoutData.data.checkoutData.cartProducts;p.each(t,function(e,t){if(t.productId==a.id)return o.amount=t.amount,o.productId=parseInt(a.id),o.variationId=t.variationId,o.tax=a.tax_collectable,o.discountAmount=t.discountAmount,o.quantity=t.quantity,o.title=t.title,s.push(o),!1})}),oliverProductTaxes=s},error:function(e){console.log(JSON.stringify(e))},complete:function(e){p(".current-taxes #loader").remove()}})}}function e(e,t,a){p("body").hasClass("page-template-page-oliver-pos-php")&&e.addEventListener(t,a,!1)}jQuery(document).ready(function(s){if(s("body").hasClass("single-product")&&s(".single_add_to_cart_button").wrapInner("<span></span>"),s("body").hasClass("woocommerce-page")&&s(".order_details tfoot tr:last-child").remove(),s("body").hasClass("term-bats")&&s(".uabb-woo-product-category").text(function(){return s(this).text().replace("Bats","TRUE / 2020")}),s("body").hasClass("single-tribe_events")&&(s(".tribe-button").wrapInner("<span></span>").parent().addClass("cta-btn solid text-center"),s(".cta-tickets-remaining .uabb-marketing-subheading").text(function(){if(s(".available-stock").length)return"Only "+s(".available-stock").first().text()+" Spots Available"})),s("body").hasClass("page-id-671")&&(s("#affwp-user-login").parent().prepend("<p class='helper'>Please choose a recognizable user name for you or your organization. Do not include any special characters. This CAN NOT be changed later. </p>"),s("#affwp-register-form legend").after("<p class='helper'>The TRUE Affiliate program is invite only! To apply, you'll need a referral code that is sent to your email. Please enter that below. </p>")),s("body").hasClass("page-template-page-oliver-pos-php")){s("#extension_finished").addClass("disabled");var e=new URLSearchParams(decodeURIComponent(window.location.search)),t=(e.get("userEmail"),e.get("location"),e.get("register"),Cookies.getJSON("truecustomtags"));null==t?k():(t.ordertype&&m(t.ordertype),0<t.salesRep.length&&h(t.salesRep),0<t.affiliate.length&&y(t.affiliate));s("#acf-form").contents().unwrap(),s(".acf-field-select, .acf-field-user").wrap("<div class='col-4'></div>"),s(".acf-field-post-object").wrap("<div class='event-ticket-search col-6'></div>"),s('<div class="col-6 current-taxes"><h3>Calculated Taxes</h3><p><span id="customFeeKey"></span>: $<span id="customFeeAmount"><span></p></div>').insertAfter(".event-ticket-search"),s(".acf-fields").addClass("row"),s(".acf-button, .ticket-data").hide(),"true-diamond-science.local"===window.location.hostname&&("Alfredo.Sanchez@truediamondscience.com",checkoutData={oliverpos:{event:"registerExtension"},data:{checkoutData:{totalTax:"",cartProducts:[{amount:80,productId:2046,variationId:0,tax:0,discountAmount:0,quantity:1,title:"TRUE Hitting Report"},{amount:45,productId:2414,variationId:0,tax:0,discountAmount:0,quantity:1,title:"2 Day Shipping"},{amount:50,productId:2053,variationId:0,tax:0,discountAmount:0,quantity:1,title:"Fitting"},{amount:560,productId:1310,variationId:1486,tax:0,discountAmount:0,quantity:2,title:"TRUE 2020 T1 USA Youth Bat -10 30.5/20.5 S"}],addressLine1:"2780 McDonough St",addressLine2:"",city:"Joliet",zip:"60436",country:"US",state:"IL"}}},r());var a=s(i+" select");a.select2(),a.on("select2:select",function(e){var t=s(i+" select").select2("data");if(t[0].id)var a=t[0].text.match(/([0-9]+) .*? /)[1];var o={action:"get_ticket_info",ticketOrderID:a,ticketID:t[0].id};return console.log(o),s.ajax({url:truefunction.ajax_url,type:"get",data:o,contentType:"application/json; charset=utf-8",dataType:"json",beforeSend:function(){s("#loader").show(),s(".ticket-data").hide(),s("#customtags_button").addClass("disabled")},success:function(e){!function(e){console.log(e),p(".ticket-data").show(),p("#event-title").text(e.event_meta.post_title),p("#event-date").text(e.event_date),p("#ticket-orderid").text(e.ticketOrderID),p("#ticket-id").text(e.attendee_info[0].attendee_id),p("#ticket-num").text(e.attendee_info[0].ticket_id),p("#ticket-type").text(e.attendee_info[0].ticket_name),p("#ticket-purchaser").text(e.attendee_info[0].holder_name),p("#ticket-cost").text(e.attendee_metadata._paid_price[0]),p("#ticket-security").text(e.attendee_info[0].security_code),"completed"===e.ticketOrderStatus||"processing"===e.ticketOrderStatus?""===e.attendee_info[0].check_in?(p("#ticket-checkin").text("Unused. You can apply this ticket to this order.").parent().addClass("alert-success").removeClass("alert-danger"),p("#customtags_button").removeClass("disabled")):"1"===e.attendee_info[0].check_in?p("#ticket-checkin").text("USED. DO NOT APPLY to this order.").parent().addClass("alert-danger").removeClass("alert-success"):p("#ticket-checkin").text(e.attendee_info[0].check_in):p("#ticket-checkin").text("ORDER "+e.ticketOrderStatus+". DO NOT APPLY to this order.").parent().addClass("alert-danger").removeClass("alert-success");p("#player-name").text(e.attendee_info[0].attendee_meta["players-name"].value)}(e)},error:function(e){console.log(JSON.stringify(e))},complete:function(e){s("#loader").hide()}}),!1}),a.on("select2:unselect",function(e){s(".ticket-data").hide(),s(".merge").empty(),s("#customtags_button").removeClass("disabled")})}s("#clearAllTags").on("click",o),s("#refreshPage").on("click",n),s("#custom_fee_add_button").on("click",r)}),p(function(){var e={byRow:!0,property:"max-height",target:p(".matchThis"),remove:!1};p(".matchHeight").matchHeight(e)}),window.addEventListener("message",function(e){if(p("body").hasClass("page-template-page-oliver-pos-php")&&"https://sell.oliverpos.com"===e.origin){var t=JSON.parse(e.data);console.log(t),"registerExtension"==t.oliverpos.event&&(checkoutData=t,r())}},!1),window.addEventListener("load",function(e){p("body").hasClass("page-template-page-oliver-pos-php")&&a()});var T=function(e){window.parent.postMessage(e,"*")};e(document.getElementById("custom_fee_remove_button"),"click",function(e){console.log("DELETE CUSTOM FEE");var t={oliverpos:{event:"deleteCustomFee"},data:{customFee:{id:document.getElementById("customFeeUniqueId").value}}};T(JSON.stringify(t))}),e(document.getElementById("customtags_button"),"click",function(e){if(console.log("POC"),!p(this).hasClass("disabled")){var t=p("#ticket-id").text(),a=p("#ticket-orderid").text(),o=p("#ticket-cost").text();if(""==(i=Cookies.getJSON("truecustomtags")).ordertypeVal){if(p(f+" select").val())var s=p(f+" option:selected").text();else s="";var i={ordertypeVal:p(f+" select").val(),ordertype:s,salesRep:p(g+" select").select2("data"),affiliate:p(v+" select").select2("data")}}if(""==i.ordertypeVal||0==i.salesRep.length)return k(),p(".savedTag").remove(),p(".acf-input").show(),p(f+" select, "+g+" select, "+v+" select").show().val("").trigger("change"),x(),void alert("Please Enter an Event Type and Sales Rep");if("league"!==i.ordertypeVal&&"facility_event"!==i.ordertypeVal||0!=i.affiliate.length){if(0<i.ordertypeVal.length&&m(i.ordertype),0<i.salesRep.length&&h(i.salesRep),y(i.affiliate),0===i.affiliate.length)var n="N/A";else n=i.affiliate[0].id;Cookies.set("truecustomtags",{ordertypeVal:i.ordertypeVal,ordertype:i.ordertype,salesRep:i.salesRep,affiliate:i.affiliate}),x();var r={oliverpos:{event:"addData"},data:{customTags:{affiliateID:n,salesRep:i.salesRep[0].id,orderType:i.ordertypeVal},ticket:{ticketNumber:t,ticketPrice:o,ticketOrderID:a}}};console.log("----- DATA TO OLIVER EXTENSION -----"),console.log(r),T(JSON.stringify(r));var c=p("#customFeeKey").text(),l=p("#customFeeAmount").text(),d={oliverpos:{event:"saveCustomFee"},data:{customFee:{id:document.getElementById("customFeeUniqueId").value,key:c,amount:l}}};console.log("----- FEE DATA TO OLIVER EXTENSION DISABLED-----"),console.log(d);var u={oliverpos:{event:"updateProductTaxes"},data:{products:oliverProductTaxes}};console.log("----- TAX DATA TO OLIVER EXTENSION -----"),console.log(u),T(JSON.stringify(u)),p(this).text("TAGS SAVED"),p("#extension_finished").removeClass("disabled")}else alert("This order type requires an affiliate")}}),e(document.getElementById("extension_finished"),"click",function(e){if(!p(this).hasClass("disabled")){var t={oliverpos:{event:"extensionFinished",wordpressAction:"tds_neworder"}};console.log("----- FINISH DATA TO OLIVER EXTENSION -----"),console.log(t),T(JSON.stringify(t)),p(this).text("CHARGE CREDIT CARD NOW"),a(!0)}});var a=function(){var e={oliverpos:{event:"togglePaymentButtons"},data:{togglePayment:{flag:0<arguments.length&&void 0!==arguments[0]&&arguments[0]}}};T(JSON.stringify(e))}}(jQuery);