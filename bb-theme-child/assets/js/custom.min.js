"use strict";var checkoutData,oliverTaxResponse,oliverProductTaxes;!function(p){var _=".acf-field-5d25148656536",m=".acf-field-5d25156b56537",f=".acf-field-5d251671a38b3",n=".acf-field-5d4a0a0c75c12";function o(){h(),p(".savedTag").remove(),p(".acf-input").show(),p(_+" select, "+m+" select, "+f+" select, "+n+" select").show().val("").trigger("change"),y()}function i(){location.reload()}function g(e){var t=p(" .tag-ordertype");p(_+" select").hide(),t&&t.remove(),p(_).append("<p class='savedTag tag-ordertype'>"+e+"</p>")}function x(e){var t=p(" .tag-sales");p(m+" .acf-input").hide(),t&&t.remove(),p(m).append("<p class='savedTag tag-sales'>"+e[0].text+"</p>")}function v(e){var t=p(" .tag-affiliate");p(f+" .acf-input").hide(),t&&t.remove(),0<e.length?p(f).append("<p class='savedTag tag-affiliate'>"+e[0].text+"</p>"):p(f).append("<p class='savedTag tag-affiliate'>N/A</p>")}function h(){var e={ordertypeVal:"",ordertype:"",salesRep:{},affiliate:{}};Cookies.set("truecustomtags",{ordertypeVal:e.ordertypeVal,ordertype:e.ordertype,salesRep:e.salesRep,affiliate:e.affiliate})}function y(){var e=Cookies.getJSON("truecustomtags");console.log(e)}function c(){var e=checkoutData;if("registerExtension"==e.oliverpos.event){console.log(e.data.checkoutData);var t={action:"get_tax_info",checkoutData:e.data.checkoutData};p.ajax({url:truefunction.ajax_url,type:"get",data:t,contentType:"application/json; charset=utf-8",dataType:"json",beforeSend:function(){console.log("REQUESTING TAX"),p(".current-taxes p").hide(),p("#loader").clone().appendTo(".current-taxes").show(),p("#customtags_button").addClass("disabled")},success:function(e){var t,s,a;console.log(e),t=oliverTaxResponse=e,p("#customtags_button").removeClass("disabled"),p(".current-taxes p").show(),p("#customFeeKey").text(t.jurisdictions.state+" Tax"),p("#customFeeAmount").text(t.amount_to_collect),s=new Array,a=oliverTaxResponse.breakdown.line_items,p.each(a,function(e,a){var o={},t=checkoutData.data.checkoutData.cartProducts;p.each(t,function(e,t){if(t.productId==a.id)return o.productId=parseInt(a.id),o.variationId=t.variationId,o.price=t.amount,o.tax=a.tax_collectable,s.push(o),!1})}),oliverProductTaxes=s},error:function(e){console.log(JSON.stringify(e))},complete:function(e){p(".current-taxes #loader").remove()}})}}function e(e,t,a){p("body").hasClass("page-template-page-oliver-pos-php")&&e.addEventListener(t,a,!1)}jQuery(document).ready(function(s){if(s("body").hasClass("single-product")&&s(".single_add_to_cart_button").wrapInner("<span></span>"),s("body").hasClass("woocommerce-page")&&s(".order_details tfoot tr:last-child").remove(),s("body").hasClass("term-bats")&&s(".uabb-woo-product-category").text(function(){return s(this).text().replace("Bats","TRUE / 2020")}),s("body").hasClass("single-tribe_events")&&(s(".tribe-button").wrapInner("<span></span>").parent().addClass("cta-btn solid text-center"),s(".cta-tickets-remaining .uabb-marketing-subheading").text(function(){if(s(".available-stock").length)return"Only "+s(".available-stock").first().text()+" Spots Available"})),s("body").hasClass("page-id-671")&&(s("#affwp-user-login").parent().prepend("<p class='helper'>Please choose a recognizable user name for you or your organization. Do not include any special characters. This CAN NOT be changed later. </p>"),s("#affwp-register-form legend").after("<p class='helper'>The TRUE Affiliate program is invite only! To apply, you'll need a referral code that is sent to your email. Please enter that below. </p>")),s("body").hasClass("page-template-page-oliver-pos-php")){s("#extension_finished").addClass("disabled");var e=new URLSearchParams(decodeURIComponent(window.location.search));e.get("userEmail"),e.get("location"),e.get("register");window.addEventListener("message",function(e){if("https://sell.oliverpos.com"===e.origin){var t=JSON.parse(e.data);"extensionSendCartData"==t.oliverpos.event&&(document.getElementById("parentData").innerHTML=t.data.oliverCartData),console.log("frame page",t)}},!1);var t=Cookies.getJSON("truecustomtags");null==t?h():(t.ordertype&&g(t.ordertype),0<t.salesRep.length&&x(t.salesRep),0<t.affiliate.length&&v(t.affiliate));s("#acf-form").contents().unwrap(),s(".acf-field-select, .acf-field-user").wrap("<div class='col-4'></div>"),s(".acf-field-post-object").wrap("<div class='event-ticket-search col-6'></div>"),s('<div class="col-6 current-taxes"><h3>Calculated Taxes</h3><p><span id="customFeeKey"></span>: $<span id="customFeeAmount"><span></p></div>').insertAfter(".event-ticket-search"),s(".acf-fields").addClass("row"),s(".acf-button, .ticket-data").hide(),"true-diamond-science.local"===window.location.hostname&&("Alfredo.Sanchez@truediamondscience.com",checkoutData={oliverpos:{event:"registerExtension"},data:{checkoutData:{totalTax:"",cartProducts:[{amount:60,productId:2496,variationId:0},{amount:280,productId:1166,variationId:1265},{amount:80,productId:2046,variationId:0},{amount:50,productId:2053,variationId:0}],addressLine1:"8275 Tournament Dr.",addressLine2:"#200",city:"Memphis",zip:"38125",country:"",state:"TN"}}},oliverTaxResponse={taxable_amount:280,tax_source:"origin",shipping:0,rate:.0925,order_total_amount:410,jurisdictions:{state:"TN",county:"SHELBY",country:"US",city:"MEMPHIS"},has_nexus:!0,freight_taxable:!0,breakdown:{taxable_amount:280,tax_collectable:25.9,state_taxable_amount:280,state_tax_rate:.07,state_tax_collectable:19.6,special_tax_rate:0,special_district_taxable_amount:0,special_district_tax_collectable:0,shipping:{taxable_amount:0,tax_collectable:0,state_taxable_amount:0,state_sales_tax_rate:.07,state_amount:0,special_taxable_amount:0,special_tax_rate:0,special_district_amount:0,county_taxable_amount:0,county_tax_rate:.0225,county_amount:0,combined_tax_rate:.0925,city_taxable_amount:0,city_tax_rate:0,city_amount:0},line_items:[{taxable_amount:280,tax_collectable:25.9,state_taxable_amount:280,state_sales_tax_rate:.07,state_amount:19.6,special_tax_rate:0,special_district_taxable_amount:0,special_district_amount:0,id:"1166",county_taxable_amount:280,county_tax_rate:.0225,county_amount:6.3,combined_tax_rate:.0925,city_taxable_amount:0,city_tax_rate:0,city_amount:0},{taxable_amount:0,tax_collectable:0,state_taxable_amount:0,state_sales_tax_rate:0,state_amount:0,special_tax_rate:0,special_district_taxable_amount:0,special_district_amount:0,id:"2046",county_taxable_amount:0,county_tax_rate:0,county_amount:0,combined_tax_rate:0,city_taxable_amount:0,city_tax_rate:0,city_amount:0},{taxable_amount:0,tax_collectable:0,state_taxable_amount:0,state_sales_tax_rate:0,state_amount:0,special_tax_rate:0,special_district_taxable_amount:0,special_district_amount:0,id:"2053",county_taxable_amount:0,county_tax_rate:0,county_amount:0,combined_tax_rate:0,city_taxable_amount:0,city_tax_rate:0,city_amount:0}],county_taxable_amount:280,county_tax_rate:.0225,county_tax_collectable:6.3,combined_tax_rate:.0925,city_taxable_amount:0,city_tax_rate:0,city_tax_collectable:0},amount_to_collect:25.9},c());var a=s(n+" select");a.select2(),a.on("select2:select",function(e){var t=s(n+" select").select2("data");if(t[0].id)var a=t[0].text.match(/([0-9]+) .*? /)[1];var o={action:"get_ticket_info",ticketOrderID:a,ticketID:t[0].id};return console.log(o),s.ajax({url:truefunction.ajax_url,type:"get",data:o,contentType:"application/json; charset=utf-8",dataType:"json",beforeSend:function(){s("#loader").show(),s(".ticket-data").hide(),s("#customtags_button").addClass("disabled")},success:function(e){!function(e){console.log(e),p(".ticket-data").show(),p("#event-title").text(e.event_meta.post_title),p("#event-date").text(e.event_date),p("#ticket-orderid").text(e.ticketOrderID),p("#ticket-id").text(e.attendee_info[0].attendee_id),p("#ticket-num").text(e.attendee_info[0].ticket_id),p("#ticket-type").text(e.attendee_info[0].ticket_name),p("#ticket-purchaser").text(e.attendee_info[0].holder_name),p("#ticket-cost").text(e.attendee_metadata._paid_price[0]),p("#ticket-security").text(e.attendee_info[0].security_code),"completed"===e.ticketOrderStatus||"processing"===e.ticketOrderStatus?""===e.attendee_info[0].check_in?(p("#ticket-checkin").text("Unused. You can apply this ticket to this order.").parent().addClass("alert-success").removeClass("alert-danger"),p("#customtags_button").removeClass("disabled")):"1"===e.attendee_info[0].check_in?p("#ticket-checkin").text("USED. DO NOT APPLY to this order.").parent().addClass("alert-danger").removeClass("alert-success"):p("#ticket-checkin").text(e.attendee_info[0].check_in):p("#ticket-checkin").text("ORDER "+e.ticketOrderStatus+". DO NOT APPLY to this order.").parent().addClass("alert-danger").removeClass("alert-success");p("#player-name").text(e.attendee_info[0].attendee_meta["players-name"].value)}(e)},error:function(e){console.log(JSON.stringify(e))},complete:function(e){s("#loader").hide()}}),!1}),a.on("select2:unselect",function(e){s(".ticket-data").hide(),s(".merge").empty(),s("#customtags_button").removeClass("disabled")})}s("#clearAllTags").on("click",o),s("#refreshPage").on("click",i),s("#custom_fee_add_button").on("click",c)}),p(function(){var e={byRow:!0,property:"max-height",target:p(".matchThis"),remove:!1};p(".matchHeight").matchHeight(e)}),window.addEventListener("message",function(e){if(p("body").hasClass("page-template-page-oliver-pos-php")&&"https://sell.oliverpos.com"===e.origin){var t=JSON.parse(e.data);console.log(t),"registerExtension"==t.oliverpos.event&&(checkoutData=t,c())}},!1);var b=function(e){window.parent.postMessage(e,"*")};e(document.getElementById("custom_fee_remove_button"),"click",function(e){console.log("DELETE CUSTOM FEE");var t={oliverpos:{event:"deleteCustomFee"},data:{customFee:{id:document.getElementById("customFeeUniqueId").value}}};b(JSON.stringify(t))}),e(document.getElementById("customtags_button"),"click",function(e){if(console.log("POC"),!p(this).hasClass("disabled")){var t=p("#ticket-id").text(),a=p("#ticket-orderid").text(),o=p("#ticket-cost").text();if(""==(n=Cookies.getJSON("truecustomtags")).ordertypeVal){if(p(_+" select").val())var s=p(_+" option:selected").text();else s="";var n={ordertypeVal:p(_+" select").val(),ordertype:s,salesRep:p(m+" select").select2("data"),affiliate:p(f+" select").select2("data")}}if(""==n.ordertypeVal||0==n.salesRep.length)return h(),p(".savedTag").remove(),p(".acf-input").show(),p(_+" select, "+m+" select, "+f+" select").show().val("").trigger("change"),y(),void alert("Please Enter an Event Type and Sales Rep");if("league"!==n.ordertypeVal&&"facility_event"!==n.ordertypeVal||0!=n.affiliate.length){if(0<n.ordertypeVal.length&&g(n.ordertype),0<n.salesRep.length&&x(n.salesRep),v(n.affiliate),0===n.affiliate.length)var i="N/A";else i=n.affiliate[0].id;Cookies.set("truecustomtags",{ordertypeVal:n.ordertypeVal,ordertype:n.ordertype,salesRep:n.salesRep,affiliate:n.affiliate}),y();var c={oliverpos:{event:"addData"},data:{customTags:{affiliateID:i,salesRep:n.salesRep[0].id,orderType:n.ordertypeVal},ticket:{ticketNumber:t,ticketPrice:o,ticketOrderID:a}}};console.log("----- DATA TO OLIVER EXTENSION -----"),console.log(c),b(JSON.stringify(c));var r=p("#customFeeKey").text(),l=p("#customFeeAmount").text(),d={oliverpos:{event:"saveCustomFee"},data:{customFee:{id:document.getElementById("customFeeUniqueId").value,key:r,amount:l}}};console.log("----- FEE DATA TO OLIVER EXTENSION DISABLED-----"),console.log(d);var u={oliverpos:{event:"updateProductTaxes"},data:{products:oliverProductTaxes}};console.log("----- TAX DATA TO OLIVER EXTENSION -----"),console.log(u),b(JSON.stringify(u)),p(this).text("TAGS SAVED"),p("#extension_finished").removeClass("disabled")}else alert("This order type requires an affiliate")}}),e(document.getElementById("extension_finished"),"click",function(e){if(!p(this).hasClass("disabled")){var t={oliverpos:{event:"extensionFinished",wordpressAction:"tds_neworder"}};console.log("----- FINISH DATA TO OLIVER EXTENSION -----"),console.log(t),b(JSON.stringify(t)),p(this).text("CHARGE CREDIT CARD NOW")}})}(jQuery);