"use strict";!function(l){var c=".acf-field-5d25148656536",d=".acf-field-5d25156b56537",p=".acf-field-5d251671a38b3",i=".acf-field-5d4a0a0c75c12";function r(){h(),l(".savedTag").remove(),l(".acf-input").show(),l(c+" select, "+d+" select, "+p+" select, "+i+" select").show().val("").trigger("change"),v()}function n(){location.reload()}function f(e){var t=l(" .tag-ordertype");l(c+" select").hide(),t&&t.remove(),l(c).append("<p class='savedTag tag-ordertype'>"+e+"</p>")}function g(e){var t=l(" .tag-sales");l(d+" .acf-input").hide(),t&&t.remove(),l(d).append("<p class='savedTag tag-sales'>"+e[0].text+"</p>")}function u(e){var t=l(" .tag-affiliate");l(p+" .acf-input").hide(),t&&t.remove(),0<e.length?l(p).append("<p class='savedTag tag-affiliate'>"+e[0].text+"</p>"):l(p).append("<p class='savedTag tag-affiliate'>N/A</p>")}function h(){var e={ordertypeVal:"",ordertype:"",salesRep:{},affiliate:{}};Cookies.set("truecustomtags",{ordertypeVal:e.ordertypeVal,ordertype:e.ordertype,salesRep:e.salesRep,affiliate:e.affiliate})}function v(){var e=Cookies.getJSON("truecustomtags");console.log(e)}function e(e,t,a){l("body").hasClass("page-template-page-oliver-pos-php")&&e.addEventListener(t,a,!1)}jQuery(document).ready(function(o){if(o("body").hasClass("single-product")&&o(".single_add_to_cart_button").wrapInner("<span></span>"),o("body").hasClass("term-bats")&&o(".uabb-woo-product-category").text(function(){return o(this).text().replace("Bats","TRUE / 2020")}),o("body").hasClass("single-tribe_events")&&o(".tribe-button").wrapInner("<span></span>").parent().addClass("cta-btn solid text-center"),o("body").hasClass("page-id-671")&&(o("#affwp-user-login").parent().prepend("<p class='helper'>Please choose a recognizable user name for you or your organization. Do not include any special characters. This CAN NOT be changed later. </p>"),o("#affwp-register-form legend").after("<p class='helper'>The TRUE Affiliate program is invite only! To apply, you'll need a referral code that is sent to your email. Please enter that below. </p>")),o("body").hasClass("page-template-page-oliver-pos-php")){var e=new URLSearchParams(decodeURIComponent(window.location.search)),t=e.get("userEmail");e.get("total");console.log("EMAIL FROM PARAMS"),console.log(t),console.log("Total FROM PARAMS"),console.log(t);var a=Cookies.getJSON("truecustomtags");null==a?h():(a.ordertype&&f(a.ordertype),0<a.salesRep.length&&g(a.salesRep),0<a.affiliate.length&&u(a.affiliate)),console.log("INITIAL COOKIE"),console.log(a),o("#acf-form").contents().unwrap(),o(".acf-field-select, .acf-field-user").wrap("<div class='col-4'></div>"),o(".acf-field-post-object").wrap("<div class='col-6'></div>"),o(".acf-fields").addClass("row"),o(".acf-button, .ticket-data").hide();var s=o(i+" select");s.select2(),s.on("select2:select",function(e){var t=o(i+" select").select2("data");if(t[0].id)var a=t[0].text.match(/([0-9]+) .*? /)[1];var s={action:"get_ticket_info",ticketOrderID:a,ticketID:t[0].id};return console.log(s),o.ajax({url:truefunction.ajax_url,type:"get",data:s,contentType:"application/json; charset=utf-8",dataType:"json",beforeSend:function(){o("#loader").show(),o(".ticket-data").hide(),o("#customtags_button").addClass("disabled")},success:function(e){!function(e){console.log(e),l(".ticket-data").show(),l("#event-title").text(e.event_meta.post_title),l("#event-date").text(e.event_date),l("#ticket-orderid").text(e.ticketOrderID),l("#ticket-id").text(e.attendee_info[0].attendee_id),l("#ticket-num").text(e.attendee_info[0].ticket_id),l("#ticket-type").text(e.attendee_info[0].ticket_name),l("#ticket-purchaser").text(e.attendee_info[0].holder_name),l("#ticket-cost").text(e.attendee_metadata._paid_price[0]),l("#ticket-security").text(e.attendee_info[0].security_code),"completed"===e.ticketOrderStatus||"processing"===e.ticketOrderStatus?(l("#customtags_button").removeClass("disabled"),""===e.attendee_info[0].check_in?l("#ticket-checkin").text("Unused. You can apply this ticket to this order.").parent().addClass("alert-success").removeClass("alert-danger"):"1"===e.attendee_info[0].check_in?l("#ticket-checkin").text("USED. DO NOT APPLY to this order.").parent().addClass("alert-danger").removeClass("alert-success"):l("#ticket-checkin").text(e.attendee_info[0].check_in)):l("#ticket-checkin").text("ORDER "+e.ticketOrderStatus+". DO NOT APPLY to this order.").parent().addClass("alert-danger").removeClass("alert-success");l("#player-name").text(e.attendee_info[0].attendee_meta["players-name"].value)}(e)},error:function(e){console.log(JSON.stringify(e))},complete:function(e){o("#loader").hide()}}),!1}),s.on("select2:unselect",function(e){o(".ticket-data").hide(),o(".merge").empty(),o("#customtags_button").removeClass("disabled")})}o("#clearAllTags").on("click",r),o("#refreshPage").on("click",n)}),l(function(){var e={byRow:!0,property:"max-height",target:l(".matchThis"),remove:!1};l(".matchHeight").matchHeight(e)}),window.addEventListener("message",function(e){if(l("body").hasClass("page-template-page-oliver-pos-php")){if(console.log(e.or),"https://true-diamond-science.local"!==e.origin){var t=JSON.parse(e.data);"extensionSendCartData"==t.oliverpos.event&&(document.getElementById("parentData").innerHTML=t.data.oliverCartData)}console.log("frame page",t)}},!1);var y=function(e){window.parent.postMessage(e,"*")};e(document.getElementById("customtags_button"),"click",function(e){if(console.log("POC"),!l(this).hasClass("disabled")){var t=l("#ticket-id").text(),a=l("#ticket-orderid").text(),s=l("#ticket-cost").text();if(""==(i=Cookies.getJSON("truecustomtags")).ordertypeVal){if(l(c+" select").val())var o=l(c+" option:selected").text();else o="";var i={ordertypeVal:l(c+" select").val(),ordertype:o,salesRep:l(d+" select").select2("data"),affiliate:l(p+" select").select2("data")}}if(""==i.ordertypeVal||0==i.salesRep.length)return h(),l(".savedTag").remove(),l(".acf-input").show(),l(c+" select, "+d+" select, "+p+" select").show().val("").trigger("change"),v(),void alert("Please Enter an Event Type and Sales Rep");if("league"!==i.ordertypeVal&&"facility_event"!==i.ordertypeVal||0!=i.affiliate.length){if(0<i.ordertypeVal.length&&f(i.ordertype),0<i.salesRep.length&&g(i.salesRep),u(i.affiliate),0===i.affiliate.length)var r="N/A";else r=i.affiliate[0].id;Cookies.set("truecustomtags",{ordertypeVal:i.ordertypeVal,ordertype:i.ordertype,salesRep:i.salesRep,affiliate:i.affiliate}),v();var n={oliverpos:{event:"addData"},data:{customTags:{affiliateID:r,salesRep:i.salesRep[0].id,orderType:i.ordertypeVal},ticket:{ticketNumber:t,ticketPrice:s,ticketOrderID:a}}};console.log("----- DATA TO OLIVER EXTENSION -----"),console.log(n),y(JSON.stringify(n))}else alert("This order type requires an affiliate")}}),e(document.getElementById("extension_finished"),"click",function(e){var t={oliverpos:{event:"extensionFinished",wordpressAction:"tds_neworder"}};console.log("----- FINISH DATA TO OLIVER EXTENSION -----"),console.log(t),y(JSON.stringify(t))})}(jQuery);