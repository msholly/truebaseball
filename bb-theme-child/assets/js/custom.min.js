"use strict";var checkoutData;!function(u){var p=".acf-field-5d25148656536",f=".acf-field-5d25156b56537",g=".acf-field-5d251671a38b3",c=".acf-field-5d4a0a0c75c12";function r(){y(),u(".savedTag").remove(),u(".acf-input").show(),u(p+" select, "+f+" select, "+g+" select, "+c+" select").show().val("").trigger("change"),k()}function l(){location.reload()}function m(e){var t=u(" .tag-ordertype");u(p+" select").hide(),t&&t.remove(),u(p).append("<p class='savedTag tag-ordertype'>"+e+"</p>")}function v(e){var t=u(" .tag-sales");u(f+" .acf-input").hide(),t&&t.remove(),u(f).append("<p class='savedTag tag-sales'>"+e[0].text+"</p>")}function h(e){var t=u(" .tag-affiliate");u(g+" .acf-input").hide(),t&&t.remove(),0<e.length?u(g).append("<p class='savedTag tag-affiliate'>"+e[0].text+"</p>"):u(g).append("<p class='savedTag tag-affiliate'>N/A</p>")}function y(){var e={ordertypeVal:"",ordertype:"",salesRep:{},affiliate:{}};Cookies.set("truecustomtags",{ordertypeVal:e.ordertypeVal,ordertype:e.ordertype,salesRep:e.salesRep,affiliate:e.affiliate})}function k(){var e=Cookies.getJSON("truecustomtags");console.log(e)}function d(){var e=checkoutData;if("registerExtension"==e.oliverpos.event){console.log(e.data.checkoutData);var t={action:"get_tax_info",checkoutData:e.data.checkoutData};u.ajax({url:truefunction.ajax_url,type:"get",data:t,contentType:"application/json; charset=utf-8",dataType:"json",beforeSend:function(){console.log("REQUESTING TAX"),u(".current-taxes p").hide(),u("#loader").clone().appendTo(".current-taxes").show(),u("#customtags_button").addClass("disabled")},success:function(e){var t;console.log(e),t=e,u("#customtags_button").removeClass("disabled"),u(".current-taxes p").show(),u("#customFeeKey").text(t.jurisdictions.state+" Tax"),u("#customFeeAmount").text(t.amount_to_collect)},error:function(e){console.log(JSON.stringify(e))},complete:function(e){u(".current-taxes #loader").remove()}})}}function e(e,t,a){u("body").hasClass("page-template-page-oliver-pos-php")&&e.addEventListener(t,a,!1)}jQuery(document).ready(function(s){if(s("body").hasClass("single-product")&&s(".single_add_to_cart_button").wrapInner("<span></span>"),s("body").hasClass("term-bats")&&s(".uabb-woo-product-category").text(function(){return s(this).text().replace("Bats","TRUE / 2020")}),s("body").hasClass("single-tribe_events")&&s(".tribe-button").wrapInner("<span></span>").parent().addClass("cta-btn solid text-center"),s("body").hasClass("page-id-671")&&(s("#affwp-user-login").parent().prepend("<p class='helper'>Please choose a recognizable user name for you or your organization. Do not include any special characters. This CAN NOT be changed later. </p>"),s("#affwp-register-form legend").after("<p class='helper'>The TRUE Affiliate program is invite only! To apply, you'll need a referral code that is sent to your email. Please enter that below. </p>")),s("body").hasClass("page-template-page-oliver-pos-php")){var e=new URLSearchParams(decodeURIComponent(window.location.search)),t=e.get("userEmail"),a=e.get("location"),o=e.get("register");console.log("EMAIL FROM PARAMS"),console.log(t),console.log("Location FROM PARAMS"),console.log(a),console.log("Register FROM PARAMS"),console.log(o);var n=Cookies.getJSON("truecustomtags");null==n?y():(n.ordertype&&m(n.ordertype),0<n.salesRep.length&&v(n.salesRep),0<n.affiliate.length&&h(n.affiliate));s("#acf-form").contents().unwrap(),s(".acf-field-select, .acf-field-user").wrap("<div class='col-4'></div>"),s(".acf-field-post-object").wrap("<div class='event-ticket-search col-6'></div>"),s('<div class="col-6 current-taxes"><h3>Calculated Taxes</h3><p><span id="customFeeKey"></span>: $<span id="customFeeAmount"><span></p></div>').insertAfter(".event-ticket-search"),s(".acf-fields").addClass("row"),s(".acf-button, .ticket-data").hide(),"true-diamond-science.local"===window.location.hostname&&(checkoutData={oliverpos:{event:"registerExtension"},data:{checkoutData:{totalTax:"",cartProducts:[{amount:45,productId:2414,variationId:0},{amount:560,productId:1352,variationId:1358},{amount:50,productId:2053,variationId:0},{amount:80,productId:2046,variationId:0}],addressLine1:"8275 Tournament Dr.",addressLine2:"#200",city:"",zip:"38125",country:"",state:"TN"}}},d());var i=s(c+" select");i.select2(),i.on("select2:select",function(e){var t=s(c+" select").select2("data");if(t[0].id)var a=t[0].text.match(/([0-9]+) .*? /)[1];var o={action:"get_ticket_info",ticketOrderID:a,ticketID:t[0].id};return console.log(o),s.ajax({url:truefunction.ajax_url,type:"get",data:o,contentType:"application/json; charset=utf-8",dataType:"json",beforeSend:function(){s("#loader").show(),s(".ticket-data").hide(),s("#customtags_button").addClass("disabled")},success:function(e){!function(e){console.log(e),u(".ticket-data").show(),u("#event-title").text(e.event_meta.post_title),u("#event-date").text(e.event_date),u("#ticket-orderid").text(e.ticketOrderID),u("#ticket-id").text(e.attendee_info[0].attendee_id),u("#ticket-num").text(e.attendee_info[0].ticket_id),u("#ticket-type").text(e.attendee_info[0].ticket_name),u("#ticket-purchaser").text(e.attendee_info[0].holder_name),u("#ticket-cost").text(e.attendee_metadata._paid_price[0]),u("#ticket-security").text(e.attendee_info[0].security_code),"completed"===e.ticketOrderStatus||"processing"===e.ticketOrderStatus?""===e.attendee_info[0].check_in?(u("#ticket-checkin").text("Unused. You can apply this ticket to this order.").parent().addClass("alert-success").removeClass("alert-danger"),u("#customtags_button").removeClass("disabled")):"1"===e.attendee_info[0].check_in?u("#ticket-checkin").text("USED. DO NOT APPLY to this order.").parent().addClass("alert-danger").removeClass("alert-success"):u("#ticket-checkin").text(e.attendee_info[0].check_in):u("#ticket-checkin").text("ORDER "+e.ticketOrderStatus+". DO NOT APPLY to this order.").parent().addClass("alert-danger").removeClass("alert-success");u("#player-name").text(e.attendee_info[0].attendee_meta["players-name"].value)}(e)},error:function(e){console.log(JSON.stringify(e))},complete:function(e){s("#loader").hide()}}),!1}),i.on("select2:unselect",function(e){s(".ticket-data").hide(),s(".merge").empty(),s("#customtags_button").removeClass("disabled")})}s("#clearAllTags").on("click",r),s("#refreshPage").on("click",l),s("#custom_fee_add_button").on("click",d)}),u(function(){var e={byRow:!0,property:"max-height",target:u(".matchThis"),remove:!1};u(".matchHeight").matchHeight(e)}),window.addEventListener("message",function(e){if(u("body").hasClass("page-template-page-oliver-pos-php")&&e){var t=JSON.parse(e.data);console.log(t),"registerExtension"==t.oliverpos.event&&(checkoutData=t,d())}},!1);var _=function(e){window.parent.postMessage(e,"*")};e(document.getElementById("custom_fee_remove_button"),"click",function(e){console.log("DELETE CUSTOM FEE");var t={oliverpos:{event:"deleteCustomFee"},data:{customFee:{id:document.getElementById("customFeeUniqueId").value}}};_(JSON.stringify(t))}),e(document.getElementById("customtags_button"),"click",function(e){if(console.log("POC"),!u(this).hasClass("disabled")){var t=u("#ticket-id").text(),a=u("#ticket-orderid").text(),o=u("#ticket-cost").text();if(""==(n=Cookies.getJSON("truecustomtags")).ordertypeVal){if(u(p+" select").val())var s=u(p+" option:selected").text();else s="";var n={ordertypeVal:u(p+" select").val(),ordertype:s,salesRep:u(f+" select").select2("data"),affiliate:u(g+" select").select2("data")}}if(""==n.ordertypeVal||0==n.salesRep.length)return y(),u(".savedTag").remove(),u(".acf-input").show(),u(p+" select, "+f+" select, "+g+" select").show().val("").trigger("change"),k(),void alert("Please Enter an Event Type and Sales Rep");if("league"!==n.ordertypeVal&&"facility_event"!==n.ordertypeVal||0!=n.affiliate.length){if(0<n.ordertypeVal.length&&m(n.ordertype),0<n.salesRep.length&&v(n.salesRep),h(n.affiliate),0===n.affiliate.length)var i="N/A";else i=n.affiliate[0].id;Cookies.set("truecustomtags",{ordertypeVal:n.ordertypeVal,ordertype:n.ordertype,salesRep:n.salesRep,affiliate:n.affiliate}),k();var c={oliverpos:{event:"addData"},data:{customTags:{affiliateID:i,salesRep:n.salesRep[0].id,orderType:n.ordertypeVal},ticket:{ticketNumber:t,ticketPrice:o,ticketOrderID:a}}};console.log("----- DATA TO OLIVER EXTENSION -----"),console.log(c),_(JSON.stringify(c));var r=u("#customFeeKey").text(),l=u("#customFeeAmount").text(),d={oliverpos:{event:"saveCustomFee"},data:{customFee:{id:document.getElementById("customFeeUniqueId").value,key:r,amount:l}}};console.log("----- FEE/TAX DATA TO OLIVER EXTENSION -----"),console.log(d),_(JSON.stringify(d))}else alert("This order type requires an affiliate")}}),e(document.getElementById("extension_finished"),"click",function(e){var t={oliverpos:{event:"extensionFinished",wordpressAction:"tds_neworder"}};console.log("----- FINISH DATA TO OLIVER EXTENSION -----"),console.log(t),_(JSON.stringify(t))})}(jQuery);